# mariadb â€” Library chart guide (single database)

## Overview
- This chart renders a single MariaDB custom resource that references an external Secret for credentials.
- The Secret must be created separately using tools like kubeseal for encrypted secret management.
- No passwords are generated by this chart - all credentials come from the external Secret.

## Files under charts/mariadb
- Chart.yaml (type: library)
- values.yaml (example values showing the single `database` block)
- templates/mariadb.yaml (renders one MariaDB CR from .Values.database)

## Creating the Secret with kubeseal

This chart expects a Secret with the following keys:
- `username`: Database username
- `password`: Password for the database user
- `root-password`: Root password for MariaDB

### Using kubeseal --raw to create encrypted secrets

1. **Create the password secret value:**
   ```bash
   # Generate a secure random password with bash
   # PASSWORD=$(openssl rand -base64 32)
   echo -n "your-password-here" | kubeseal --raw --from-file=/dev/stdin --name mariadb-user --namespace your-namespace
   ```

2. **Create the root password secret value:**
   ```bash
   # Generate a secure random root password with bash
   # ROOT_PASSWORD=$(openssl rand -base64 32)
   echo -n "your-root-password-here" | kubeseal --raw --from-file=/dev/stdin --name mariadb-user --namespace your-namespace
   ```

3. **Create the username secret value:**
   ```bash
   echo -n "root" | kubeseal --raw --from-file=/dev/stdin --name mariadb-user --namespace your-namespace
   ```

4. **Create a SealedSecret manifest:**
   ```yaml
   apiVersion: bitnami.com/v1alpha1
   kind: SealedSecret
   metadata:
     name: mariadb-user
     namespace: your-namespace
   spec:
     encryptedData:
       username: <encrypted-username-from-step-3>
       password: <encrypted-password-from-step-1>
       root-password: <encrypted-root-password-from-step-2>
     template:
       metadata:
         name: mariadb-user
         namespace: your-namespace
       type: Opaque
   ```

5. **Apply the SealedSecret:**
   ```bash
   kubectl apply -f mariadb-sealedsecret.yaml
   ```

### Alternative: Create a regular Secret (for development)

For development environments, you can create a regular Kubernetes Secret:

```bash
kubectl create secret generic mariadb-user \
  --from-literal=username=root \
  --from-literal=password=your-password \
  --from-literal=root-password=your-root-password \
  --namespace your-namespace
```

## Values reference

Below are all supported keys under the top-level `database` block:

- **enabled** (boolean)
  - default: true
  - description: Enable rendering of the MariaDB CR.

- **name** (string)
  - default: "mariadb"
  - description: Kubernetes resource name for the MariaDB CR.

- **secretName** (string)
  - default: "mariadb-user"
  - description: Name of the Secret resource that contains credentials. This secret must exist before deploying the chart.

- **database** (string)
  - default: "appdb"
  - description: Logical database name that the MariaDB CR should create/manage.

- **username** (string)
  - default: "root"
  - description: Database username (must match the username in the secret).

- **replicas** (integer)
  - default: 1
  - description: Number of MariaDB replicas.

- **port** (integer)
  - default: 3306
  - description: TCP port MariaDB listens on.

- **storage** (object)
  - **size** (string, default: "1Gi"): Storage size for MariaDB
  - **storageClassName** (string, default: "local-path"): Storage class for PVC

- **resources** (object)
  - **requests/limits** for cpu and memory allocation

## Important Notes

- The Secret must exist before deploying this chart
- The MariaDB operator will use the credentials from the Secret to configure the database
- To update passwords, update the SealedSecret and redeploy - the operator will handle the credential updates
- The chart no longer generates any passwords internally
